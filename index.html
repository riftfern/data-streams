<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANT TERMINAL v1.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap');

        :root {
            /* Colorblind-friendly dark mode (default) */
            --bg-primary: #1e1e1e;
            --bg-secondary: #252526;
            --bg-tertiary: #2d2d30;
            --text-primary: #d4d4d4;
            --text-secondary: #808080;
            --accent-blue: #569cd6;
            --accent-cyan: #4ec9b0;
            --accent-orange: #ce9178;
            --accent-yellow: #dcdcaa;
            --accent-green: #6a9955;
            --accent-pink: #c586c0;
            --border-color: #404040;
            --highlight-bg: rgba(86, 156, 214, 0.1);
            --scanline-opacity: 0.02;

            /* Semantic colors */
            --color-buy: #4ec9b0;
            --color-sell: #f48771;
            --color-large: #dcdcaa;
            --color-huge: #c586c0;
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8e8e8;
            --text-primary: #1e1e1e;
            --text-secondary: #6e6e6e;
            --accent-blue: #0066cc;
            --accent-cyan: #008080;
            --accent-orange: #a31515;
            --accent-yellow: #795e26;
            --accent-green: #008000;
            --accent-pink: #af00db;
            --border-color: #c8c8c8;
            --highlight-bg: rgba(0, 102, 204, 0.1);
            --scanline-opacity: 0.01;

            --color-buy: #008080;
            --color-sell: #c72e2e;
            --color-large: #795e26;
            --color-huge: #af00db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            font-family: 'VT323', 'Share Tech Mono', monospace;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
        }

        /* CRT Screen Effect Container */
        .crt {
            position: relative;
            overflow: hidden;
        }

        .crt::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, var(--scanline-opacity)),
                rgba(0, 0, 0, var(--scanline-opacity)) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
        }

        .crt::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.15) 100%);
            pointer-events: none;
            z-index: 999;
        }

        /* Flicker Animation */
        @keyframes flicker {
            0% { opacity: 0.98; }
            50% { opacity: 0.96; }
            100% { opacity: 0.98; }
        }

        .terminal-container {
            animation: flicker 0.15s infinite;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            border: 2px solid var(--accent-blue);
            padding: 15px 20px;
            margin-bottom: 20px;
            background: var(--bg-secondary);
            box-shadow: 0 0 10px rgba(86, 156, 214, 0.2);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 32px;
            letter-spacing: 4px;
            color: var(--accent-blue);
            text-shadow: 0 0 10px rgba(86, 156, 214, 0.5);
        }

        .header-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .header-status {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: var(--accent-orange);
        }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch::before {
            content: "";
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: var(--accent-blue);
            transition: transform 0.3s;
        }

        .toggle-switch.light::before {
            transform: translateX(26px);
            background: var(--accent-yellow);
        }

        /* Blinking cursor */
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background: var(--accent-blue);
            animation: blink 1s infinite;
            vertical-align: middle;
            margin-left: 5px;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: transparent;
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
            padding: 10px 20px;
            font-family: inherit;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
        }

        .nav-tab:hover {
            background: var(--highlight-bg);
            box-shadow: 0 0 10px rgba(86, 156, 214, 0.3);
        }

        .nav-tab.active {
            background: var(--accent-blue);
            color: var(--bg-primary);
            text-shadow: none;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            border: 1px solid var(--accent-cyan);
            padding: 15px;
            background: var(--bg-secondary);
        }

        .stat-label {
            font-size: 14px;
            color: var(--accent-cyan);
            opacity: 0.8;
        }

        .stat-value {
            font-size: 28px;
            color: var(--accent-cyan);
            text-shadow: 0 0 10px rgba(78, 201, 176, 0.3);
        }

        /* Data Panel */
        .data-panel {
            border: 2px solid var(--accent-blue);
            background: var(--bg-secondary);
            box-shadow: 0 0 20px rgba(86, 156, 214, 0.1);
            display: none;
        }

        .data-panel.active {
            display: block;
        }

        .panel-header {
            background: var(--bg-tertiary);
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent-blue);
        }

        .panel-controls {
            display: flex;
            gap: 10px;
        }

        .panel-btn {
            background: transparent;
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
            padding: 5px 15px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
        }

        .panel-btn:hover {
            background: var(--highlight-bg);
        }

        /* Data Table */
        .data-table-container {
            max-height: 500px;
            overflow-y: auto;
            overflow-x: auto;
        }

        .data-table-container::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .data-table-container::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .data-table-container::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
            border: 2px solid var(--bg-primary);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 16px;
        }

        .data-table th {
            background: var(--bg-tertiary);
            padding: 12px 10px;
            text-align: left;
            position: sticky;
            top: 0;
            border-bottom: 2px solid var(--accent-blue);
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 1px;
            cursor: pointer;
            color: var(--accent-blue);
        }

        .data-table th:hover {
            background: var(--highlight-bg);
        }

        .data-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tr:hover {
            background: var(--highlight-bg);
        }

        /* Side indicators - colorblind friendly */
        .side-buy {
            color: var(--color-buy);
            text-shadow: 0 0 5px rgba(78, 201, 176, 0.5);
        }

        .side-sell {
            color: var(--color-sell);
            text-shadow: 0 0 5px rgba(244, 135, 113, 0.5);
        }

        .size-large {
            color: var(--color-large);
            font-weight: bold;
        }

        .size-huge {
            color: var(--color-huge);
            font-weight: bold;
            animation: blink 0.5s infinite;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 24px;
        }

        @keyframes loadingDots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }

        .loading::after {
            content: '';
            animation: loadingDots 1.5s infinite;
        }

        /* Symbol filter */
        .filter-bar {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-label {
            font-size: 14px;
            color: var(--accent-orange);
        }

        .filter-input {
            background: var(--bg-primary);
            border: 1px solid var(--accent-blue);
            color: var(--text-primary);
            padding: 8px 12px;
            font-family: inherit;
            font-size: 16px;
            width: 150px;
        }

        .filter-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(86, 156, 214, 0.5);
        }

        .filter-input::placeholder {
            color: var(--text-secondary);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            margin-top: 20px;
        }

        /* ASCII Art */
        .ascii-art {
            font-size: 10px;
            line-height: 1.1;
            color: var(--accent-blue);
            opacity: 0.7;
            white-space: pre;
            font-family: monospace;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 50px;
            color: var(--text-secondary);
            font-size: 18px;
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 20px;
            padding: 10px 15px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-title {
                font-size: 24px;
            }
            .data-table {
                font-size: 14px;
            }
            .stat-value {
                font-size: 22px;
            }
            .header-top {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="crt">
        <div class="terminal-container">
            <!-- Header -->
            <div class="header">
                <div class="header-top">
                    <div>
                        <div class="header-title">
                            QUANT TERMINAL v1.0<span class="cursor"></span>
                        </div>
                        <div class="header-subtitle">
                            >> BINANCE FUTURES MARKET SURVEILLANCE SYSTEM
                        </div>
                    </div>
                    <div class="theme-toggle">
                        <span class="theme-toggle-label">DARK</span>
                        <div class="toggle-switch" id="theme-toggle" onclick="toggleTheme()"></div>
                        <span class="theme-toggle-label">LIGHT</span>
                    </div>
                </div>
                <div class="header-status">
                    <span id="status-time">SYSTEM TIME: --:--:--</span>
                    <span id="status-records">RECORDS LOADED: 0</span>
                </div>
            </div>

            <!-- Navigation -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-panel="liquidations">[1] LIQUIDATIONS</button>
                <button class="nav-tab" data-panel="big-liqs">[2] BIG LIQS (&gt;$100K)</button>
                <button class="nav-tab" data-panel="trades">[3] LARGE TRADES</button>
                <button class="nav-tab" data-panel="overview">[4] OVERVIEW</button>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-box">
                    <div class="stat-label">TOTAL LIQUIDATIONS</div>
                    <div class="stat-value" id="stat-liqs">--</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">TOTAL LIQ VALUE</div>
                    <div class="stat-value" id="stat-liq-value">--</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">LARGE TRADES</div>
                    <div class="stat-value" id="stat-trades">--</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">BIG LIQS (&gt;$100K)</div>
                    <div class="stat-value" id="stat-big-liqs">--</div>
                </div>
            </div>

            <!-- Liquidations Panel -->
            <div class="data-panel active" id="panel-liquidations">
                <div class="panel-header">
                    <span class="panel-title">LIQUIDATION FEED</span>
                    <div class="panel-controls">
                        <button class="panel-btn" onclick="sortTable('liqs', 'usd_size')">SORT BY SIZE</button>
                        <button class="panel-btn" onclick="sortTable('liqs', 'time')">SORT BY TIME</button>
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-buy);"></div>
                        <span>BUY (Long Liquidated)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-sell);"></div>
                        <span>SELL (Short Liquidated)</span>
                    </div>
                </div>
                <div class="filter-bar">
                    <span class="filter-label">FILTER:</span>
                    <input type="text" class="filter-input" id="filter-liqs-symbol" placeholder="SYMBOL" oninput="filterTable('liqs')">
                    <input type="text" class="filter-input" id="filter-liqs-side" placeholder="BUY/SELL" oninput="filterTable('liqs')">
                    <input type="number" class="filter-input" id="filter-liqs-min" placeholder="MIN USD" oninput="filterTable('liqs')">
                </div>
                <div class="data-table-container">
                    <table class="data-table" id="table-liqs">
                        <thead>
                            <tr>
                                <th>TIME</th>
                                <th>SYMBOL</th>
                                <th>SIDE</th>
                                <th>PRICE</th>
                                <th>QTY</th>
                                <th>USD SIZE</th>
                                <th>STATUS</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-liqs">
                            <tr><td colspan="7" class="loading">LOADING DATA</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Big Liquidations Panel -->
            <div class="data-panel" id="panel-big-liqs">
                <div class="panel-header">
                    <span class="panel-title">WHALE LIQUIDATIONS (&gt;$100K)</span>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-buy);"></div>
                        <span>BUY (Long Liquidated)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-sell);"></div>
                        <span>SELL (Short Liquidated)</span>
                    </div>
                </div>
                <div class="data-table-container">
                    <table class="data-table" id="table-big-liqs">
                        <thead>
                            <tr>
                                <th>TIME</th>
                                <th>SYMBOL</th>
                                <th>SIDE</th>
                                <th>PRICE</th>
                                <th>QTY</th>
                                <th>USD SIZE</th>
                                <th>STATUS</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-big-liqs">
                            <tr><td colspan="7" class="loading">LOADING DATA</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Trades Panel -->
            <div class="data-panel" id="panel-trades">
                <div class="panel-header">
                    <span class="panel-title">LARGE TRADES FEED</span>
                    <div class="panel-controls">
                        <button class="panel-btn" onclick="sortTable('trades', 'usd')">SORT BY SIZE</button>
                        <button class="panel-btn" onclick="sortTable('trades', 'time')">SORT BY TIME</button>
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-buy);"></div>
                        <span>BUYER (Taker Buy)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-sell);"></div>
                        <span>SELLER (Taker Sell)</span>
                    </div>
                </div>
                <div class="filter-bar">
                    <span class="filter-label">FILTER:</span>
                    <input type="text" class="filter-input" id="filter-trades-symbol" placeholder="SYMBOL" oninput="filterTable('trades')">
                    <input type="text" class="filter-input" id="filter-trades-side" placeholder="BUYER/SELLER" oninput="filterTable('trades')">
                </div>
                <div class="data-table-container">
                    <table class="data-table" id="table-trades">
                        <thead>
                            <tr>
                                <th>TIME</th>
                                <th>SYMBOL</th>
                                <th>PRICE</th>
                                <th>QUANTITY</th>
                                <th>USD VALUE</th>
                                <th>SIDE</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-trades">
                            <tr><td colspan="6" class="loading">LOADING DATA</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Overview Panel -->
            <div class="data-panel" id="panel-overview">
                <div class="panel-header">
                    <span class="panel-title">SYSTEM OVERVIEW</span>
                </div>
                <div style="padding: 20px;">
                    <pre class="ascii-art">
    ██████╗ ██╗   ██╗ █████╗ ███╗   ██╗████████╗
   ██╔═══██╗██║   ██║██╔══██╗████╗  ██║╚══██╔══╝
   ██║   ██║██║   ██║███████║██╔██╗ ██║   ██║
   ██║▄▄ ██║██║   ██║██╔══██║██║╚██╗██║   ██║
   ╚██████╔╝╚██████╔╝██║  ██║██║ ╚████║   ██║
    ╚══▀▀═╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═══╝   ╚═╝

   ████████╗███████╗██████╗ ███╗   ███╗██╗███╗   ██╗ █████╗ ██╗
   ╚══██╔══╝██╔════╝██╔══██╗████╗ ████║██║████╗  ██║██╔══██╗██║
      ██║   █████╗  ██████╔╝██╔████╔██║██║██╔██╗ ██║███████║██║
      ██║   ██╔══╝  ██╔══██╗██║╚██╔╝██║██║██║╚██╗██║██╔══██║██║
      ██║   ███████╗██║  ██║██║ ╚═╝ ██║██║██║ ╚████║██║  ██║███████╗
      ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚══════╝
                    </pre>
                    <div style="margin-top: 30px; line-height: 1.8;">
                        <p>>> BINANCE FUTURES MARKET SURVEILLANCE SYSTEM</p>
                        <p>>> MONITORING: LIQUIDATIONS | LARGE TRADES | FUNDING RATES</p>
                        <p>>> TRACKED SYMBOLS: BTC, ETH, SOL, BNB, DOGE + ALL LIQ EVENTS</p>
                        <p>>> THRESHOLDS: LIQS > $3K | BIG LIQS > $100K | TRADES > $15K</p>
                        <br>
                        <p style="color: var(--accent-orange);">>> DATA SOURCES:</p>
                        <p>   - binance.csv - Liquidation events</p>
                        <p>   - binance_big_liqs.csv - Whale liquidations</p>
                        <p>   - binance_trades.csv - Large spot trades</p>
                        <br>
                        <div id="overview-stats"></div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                [ QUANT TERMINAL v1.0 ] - DATA STREAMS MONITOR - SYSTEM OPERATIONAL
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let liqData = [];
        let bigLiqData = [];
        let tradeData = [];
        let sortOrders = { liqs: {}, trades: {} };

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const toggle = document.getElementById('theme-toggle');
            const isLight = html.getAttribute('data-theme') === 'light';

            if (isLight) {
                html.removeAttribute('data-theme');
                toggle.classList.remove('light');
                localStorage.setItem('theme', 'dark');
            } else {
                html.setAttribute('data-theme', 'light');
                toggle.classList.add('light');
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme
        function loadTheme() {
            const saved = localStorage.getItem('theme');
            if (saved === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                document.getElementById('theme-toggle').classList.add('light');
            }
        }
        loadTheme();

        // Update system time
        function updateTime() {
            const now = new Date();
            document.getElementById('status-time').textContent =
                `SYSTEM TIME: ${now.toLocaleTimeString('en-US', { hour12: false })}`;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Tab navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.data-panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`panel-${tab.dataset.panel}`).classList.add('active');
            });
        });

        // Parse CSV without headers - returns array of arrays
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            return lines.map(line => {
                // Handle potential commas in values by splitting carefully
                return line.split(',').map(v => v.trim());
            }).filter(row => row.length > 1 && row[0] !== '');
        }

        // Format timestamp
        function formatTime(timestamp) {
            const ts = parseInt(timestamp);
            if (isNaN(ts)) return '--';
            const date = new Date(ts);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
        }

        // Format USD
        function formatUSD(value) {
            const num = parseFloat(value);
            if (isNaN(num)) return '--';
            return '$' + num.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        // Format number
        function formatNumber(value, decimals = 2) {
            const num = parseFloat(value);
            if (isNaN(num)) return '--';
            return num.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        }

        // Get size class
        function getSizeClass(usd) {
            const value = parseFloat(usd);
            if (value >= 500000) return 'size-huge';
            if (value >= 100000) return 'size-large';
            return '';
        }

        // Get side class
        function getSideClass(side) {
            if (!side) return '';
            const s = side.toString().toUpperCase();
            if (s === 'BUY' || s === 'BUYER') return 'side-buy';
            if (s === 'SELL' || s === 'SELLER') return 'side-sell';
            return '';
        }

        /*
         * CSV Column mapping for liquidations (binance.csv):
         * 0: symbol
         * 1: side (BUY/SELL)
         * 2: order_type (LIMIT)
         * 3: time_in_force (IOC)
         * 4: original_quantity
         * 5: price
         * 6: average_price
         * 7: order_status (FILLED)
         * 8: order_last_filled_quantity
         * 9: order_filled_accumulated_quantity
         * 10: order_trade_time (timestamp)
         * 11: usd_size
         */

        // Render liquidations table
        function renderLiqs(data) {
            const tbody = document.getElementById('tbody-liqs');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">NO DATA AVAILABLE</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(row => {
                const symbol = row[0];
                const side = row[1];
                const qty = row[4];
                const avgPrice = row[6];
                const status = row[7];
                const time = row[10];
                const usdSize = row[11] || (parseFloat(avgPrice) * parseFloat(qty));

                return `
                    <tr>
                        <td>${formatTime(time)}</td>
                        <td style="color: var(--accent-cyan);">${symbol || '--'}</td>
                        <td class="${getSideClass(side)}">${side || '--'}</td>
                        <td>${formatNumber(avgPrice, 6)}</td>
                        <td>${formatNumber(qty, 2)}</td>
                        <td class="${getSizeClass(usdSize)}">${formatUSD(usdSize)}</td>
                        <td>${status || '--'}</td>
                    </tr>
                `;
            }).join('');
        }

        // Render big liquidations table
        function renderBigLiqs(data) {
            const tbody = document.getElementById('tbody-big-liqs');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">NO WHALE LIQUIDATIONS RECORDED</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(row => {
                const symbol = row[0];
                const side = row[1];
                const qty = row[4];
                const avgPrice = row[6];
                const status = row[7];
                const time = row[10];
                const usdSize = row[11] || (parseFloat(avgPrice) * parseFloat(qty));

                return `
                    <tr>
                        <td>${formatTime(time)}</td>
                        <td style="color: var(--accent-cyan);">${symbol || '--'}</td>
                        <td class="${getSideClass(side)}">${side || '--'}</td>
                        <td>${formatNumber(avgPrice, 6)}</td>
                        <td>${formatNumber(qty, 2)}</td>
                        <td class="size-huge">${formatUSD(usdSize)}</td>
                        <td>${status || '--'}</td>
                    </tr>
                `;
            }).join('');
        }

        /*
         * CSV Column mapping for trades (binance_trades.csv):
         * 0: Event Time (timestamp)
         * 1: Symbol
         * 2: Aggregate Trade ID
         * 3: Price
         * 4: Quantity
         * 5: First Trade ID
         * 6: is Buyer Maker (True/False)
         */

        // Render trades table
        function renderTrades(data) {
            const tbody = document.getElementById('tbody-trades');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">NO DATA AVAILABLE</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(row => {
                const eventTime = row[0];
                const symbol = row[1];
                const price = row[3];
                const quantity = row[4];
                const isBuyerMaker = row[6];

                const usdValue = parseFloat(price) * parseFloat(quantity);
                // If isBuyerMaker is True, the taker was a seller; if False, taker was buyer
                const side = (isBuyerMaker === 'True' || isBuyerMaker === 'true') ? 'SELLER' : 'BUYER';

                return `
                    <tr>
                        <td>${formatTime(eventTime)}</td>
                        <td style="color: var(--accent-cyan);">${(symbol || '--').trim()}</td>
                        <td>${formatNumber(price, 4)}</td>
                        <td>${formatNumber(quantity, 4)}</td>
                        <td class="${getSizeClass(usdValue)}">${formatUSD(usdValue)}</td>
                        <td class="${getSideClass(side)}">${side}</td>
                    </tr>
                `;
            }).join('');
        }

        // Sort table
        function sortTable(tableType, column) {
            if (!sortOrders[tableType][column]) {
                sortOrders[tableType][column] = 'desc';
            } else {
                sortOrders[tableType][column] = sortOrders[tableType][column] === 'desc' ? 'asc' : 'desc';
            }

            const order = sortOrders[tableType][column];

            if (tableType === 'liqs') {
                liqData.sort((a, b) => {
                    let valA, valB;
                    if (column === 'usd_size') {
                        valA = parseFloat(a[11]) || 0;
                        valB = parseFloat(b[11]) || 0;
                    } else if (column === 'time') {
                        valA = parseInt(a[10]) || 0;
                        valB = parseInt(b[10]) || 0;
                    }
                    return order === 'desc' ? valB - valA : valA - valB;
                });
                renderLiqs(liqData);
            } else if (tableType === 'trades') {
                tradeData.sort((a, b) => {
                    let valA, valB;
                    if (column === 'usd') {
                        valA = parseFloat(a[3]) * parseFloat(a[4]) || 0;
                        valB = parseFloat(b[3]) * parseFloat(b[4]) || 0;
                    } else if (column === 'time') {
                        valA = parseInt(a[0]) || 0;
                        valB = parseInt(b[0]) || 0;
                    }
                    return order === 'desc' ? valB - valA : valA - valB;
                });
                renderTrades(tradeData);
            }
        }

        // Filter table
        function filterTable(tableType) {
            if (tableType === 'liqs') {
                const symbolFilter = document.getElementById('filter-liqs-symbol').value.toUpperCase();
                const sideFilter = document.getElementById('filter-liqs-side').value.toUpperCase();
                const minFilter = parseFloat(document.getElementById('filter-liqs-min').value) || 0;

                const filtered = liqData.filter(row => {
                    const symbol = (row[0] || '').toUpperCase();
                    const side = (row[1] || '').toUpperCase();
                    const usd = parseFloat(row[11]) || 0;

                    return symbol.includes(symbolFilter) &&
                           side.includes(sideFilter) &&
                           usd >= minFilter;
                });
                renderLiqs(filtered);
            } else if (tableType === 'trades') {
                const symbolFilter = document.getElementById('filter-trades-symbol').value.toUpperCase();
                const sideFilter = document.getElementById('filter-trades-side').value.toUpperCase();

                const filtered = tradeData.filter(row => {
                    const symbol = (row[1] || '').toUpperCase();
                    const isBuyerMaker = row[6];
                    const side = (isBuyerMaker === 'True' || isBuyerMaker === 'true') ? 'SELLER' : 'BUYER';

                    return symbol.includes(symbolFilter) && side.includes(sideFilter);
                });
                renderTrades(filtered);
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('stat-liqs').textContent = liqData.length.toLocaleString();
            document.getElementById('stat-trades').textContent = tradeData.length.toLocaleString();
            document.getElementById('stat-big-liqs').textContent = bigLiqData.length.toLocaleString();

            const totalLiqValue = liqData.reduce((sum, row) => sum + (parseFloat(row[11]) || 0), 0);
            document.getElementById('stat-liq-value').textContent = formatUSD(totalLiqValue);

            document.getElementById('status-records').textContent =
                `RECORDS LOADED: ${(liqData.length + tradeData.length + bigLiqData.length).toLocaleString()}`;

            // Overview stats
            const buyLiqs = liqData.filter(r => r[1] === 'BUY').length;
            const sellLiqs = liqData.filter(r => r[1] === 'SELL').length;

            document.getElementById('overview-stats').innerHTML = `
                <p style="color: var(--accent-cyan);">>> STATISTICS:</p>
                <p>   - Total Liquidations: ${liqData.length.toLocaleString()}</p>
                <p>   - BUY Liquidations: <span class="side-buy">${buyLiqs.toLocaleString()}</span></p>
                <p>   - SELL Liquidations: <span class="side-sell">${sellLiqs.toLocaleString()}</span></p>
                <p>   - Total Liq Value: ${formatUSD(totalLiqValue)}</p>
                <p>   - Large Trades: ${tradeData.length.toLocaleString()}</p>
                <p>   - Whale Liqs (>$100K): ${bigLiqData.length.toLocaleString()}</p>
            `;
        }

        // Load data
        async function loadData() {
            try {
                // Load liquidations
                const liqResponse = await fetch('binance.csv');
                if (liqResponse.ok) {
                    const liqCSV = await liqResponse.text();
                    liqData = parseCSV(liqCSV);
                    // Sort by time descending (most recent first) - column 10
                    liqData.sort((a, b) => parseInt(b[10]) - parseInt(a[10]));
                    renderLiqs(liqData);
                }
            } catch (e) {
                console.error('Error loading liquidations:', e);
                document.getElementById('tbody-liqs').innerHTML =
                    '<tr><td colspan="7" class="empty-state">ERROR LOADING DATA</td></tr>';
            }

            try {
                // Load big liquidations
                const bigLiqResponse = await fetch('binance_big_liqs.csv');
                if (bigLiqResponse.ok) {
                    const bigLiqCSV = await bigLiqResponse.text();
                    bigLiqData = parseCSV(bigLiqCSV);
                    bigLiqData.sort((a, b) => parseInt(b[10]) - parseInt(a[10]));
                    renderBigLiqs(bigLiqData);
                }
            } catch (e) {
                console.error('Error loading big liquidations:', e);
                document.getElementById('tbody-big-liqs').innerHTML =
                    '<tr><td colspan="7" class="empty-state">ERROR LOADING DATA</td></tr>';
            }

            try {
                // Load trades
                const tradeResponse = await fetch('binance_trades.csv');
                if (tradeResponse.ok) {
                    const tradeCSV = await tradeResponse.text();
                    tradeData = parseCSV(tradeCSV);
                    // Sort by time descending - column 0
                    tradeData.sort((a, b) => parseInt(b[0]) - parseInt(a[0]));
                    renderTrades(tradeData);
                }
            } catch (e) {
                console.error('Error loading trades:', e);
                document.getElementById('tbody-trades').innerHTML =
                    '<tr><td colspan="6" class="empty-state">ERROR LOADING DATA</td></tr>';
            }

            updateStats();
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
